{% extends 'admin/base.html.twig' %}

{% block title %}Mentors - {{ company.companyName }} - EPROFOS Admin{% endblock %}

{% block page_header %}
    <div class="page-header d-print-none">
        <div class="container-xl">
            <div class="row g-2 align-items-center">
                <div class="col">
                    <!-- Page pre-title -->
                    <div class="page-pretitle">
                        <a href="{{ path('admin_dashboard') }}" class="text-muted">Administration</a> / 
                        <a href="{{ path('admin_alternance_dashboard') }}" class="text-muted">Alternance</a> /
                        <a href="{{ path('admin_alternance_company_index') }}" class="text-muted">Entreprises</a> /
                        <a href="{{ path('admin_alternance_company_show', {siret: company.companySiret}) }}" class="text-muted">{{ company.companyName }}</a>
                    </div>
                    <h2 class="page-title">
                        Mentors - {{ company.companyName }}
                    </h2>
                </div>
                <!-- Page title actions -->
                <div class="col-auto ms-auto d-print-none">
                    <div class="btn-list">
                        <a href="{{ path('admin_alternance_company_show', {siret: company.companySiret}) }}" class="btn btn-outline-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <polyline points="15,6 9,12 15,18"/>
                            </svg>
                            Retour à l'entreprise
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block body %}
    <!-- Company Info Header -->
    <div class="card mb-3">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col">
                    <h3 class="mb-0">{{ company.companyName }}</h3>
                    <div class="text-muted">SIRET: {{ company.companySiret }}</div>
                    {% if companyAddress %}
                        <div class="text-muted">{{ companyAddress }}</div>
                    {% endif %}
                </div>
                <div class="col-auto">
                    <div class="text-center">
                        <div class="h1 mb-0 text-primary">{{ mentors|length }}</div>
                        <div class="text-muted">Mentor(s)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mentors List -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Liste des mentors</h3>
        </div>
        <div class="table-responsive">
            <table class="table table-vcenter card-table">
                <thead>
                    <tr>
                        <th>Mentor</th>
                        <th>Contact</th>
                        <th>Domaines d'expertise</th>
                        <th>Date d'inscription</th>
                        <th class="text-center">Statut</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mentor in mentors %}
                        <tr>
                            <td>
                                <div class="d-flex py-1 align-items-center">
                                    <span class="avatar me-2">{{ mentor.firstName|first }}{{ mentor.lastName|first }}</span>
                                    <div class="flex-fill">
                                        <div class="font-weight-medium">{{ mentor.firstName }} {{ mentor.lastName }}</div>
                                        {% if mentor.jobTitle %}
                                            <div class="text-muted">{{ mentor.jobTitle }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <div class="text-muted">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <circle cx="12" cy="12" r="4"/>
                                            <path d="m16 12l4 0"/>
                                            <path d="m12 16l0 4"/>
                                            <path d="m8 12l-4 0"/>
                                            <path d="m12 8l0 -4"/>
                                        </svg>
                                        {{ mentor.email }}
                                    </div>
                                    {% if mentor.phone %}
                                        <div class="text-muted">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2"/>
                                            </svg>
                                            {{ mentor.phone }}
                                        </div>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% if mentor.expertiseDomains %}
                                    {% for domain in mentor.expertiseDomains|slice(0, 3) %}
                                        <span class="badge bg-blue-lt me-1">{{ domain }}</span>
                                    {% endfor %}
                                    {% if mentor.expertiseDomains|length > 3 %}
                                        <span class="text-muted">+{{ mentor.expertiseDomains|length - 3 }} autres</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Non renseigné</span>
                                {% endif %}
                            </td>
                            <td class="text-muted">
                                {{ mentor.createdAt|date('d/m/Y H:i') }}
                            </td>
                            <td class="text-center">
                                <span class="badge bg-{{ mentor.isActive ? 'success' : 'secondary' }}-lt">
                                    {{ mentor.isActive ? 'Actif' : 'Inactif' }}
                                </span>
                            </td>
                            <td>
                                <div class="btn-list justify-content-end">
                                    <a href="{{ path('admin_alternance_mentor_show', {id: mentor.id}) }}" class="btn btn-sm btn-outline-primary">
                                        Voir détails
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-muted py-5">
                                <div class="empty">
                                    <div class="empty-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <circle cx="12" cy="7" r="4"/>
                                            <path d="m6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"/>
                                        </svg>
                                    </div>
                                    <p class="empty-title">Aucun mentor</p>
                                    <p class="empty-subtitle text-muted">
                                        Cette entreprise n'a pas encore de mentor enregistré.
                                    </p>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Summary Statistics -->
    {% if mentors|length > 0 %}
        <div class="row row-deck row-cards mt-3">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="h1 mb-0 text-success">{{ mentors|filter(m => m.isActive)|length }}</div>
                        <div class="text-muted">Mentors actifs</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="h1 mb-0 text-secondary">{{ mentors|filter(m => not m.isActive)|length }}</div>
                        <div class="text-muted">Mentors inactifs</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="h1 mb-0 text-info">
                            {% set total_domains = 0 %}
                            {% for mentor in mentors %}
                                {% set total_domains = total_domains + (mentor.expertiseDomains ? mentor.expertiseDomains|length : 0) %}
                            {% endfor %}
                            {{ total_domains }}
                        </div>
                        <div class="text-muted">Domaines d'expertise</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body text-center">
                        <div class="h1 mb-0 text-warning">
                            {% if mentors|length > 0 %}
                                {{ (total_domains / mentors|length)|round(1) }}
                            {% else %}
                                0
                            {% endif %}
                        </div>
                        <div class="text-muted">Moyenne par mentor</div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
