{% extends 'admin/base.html.twig' %}

{% set page_title = 'Modifier ' ~ teacher.displayName %}

{% block title %}{{ page_title }}{% endblock %}

{% block page_actions %}
    <div class="btn-list">
        <a href="{{ path('admin_teacher_show', {id: teacher.id}) }}" class="btn btn-outline-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M9 6l6 6l-6 6"/>
            </svg>
            Retour au profil
        </a>
        <a href="{{ path('admin_teacher_index') }}" class="btn btn-outline-secondary">
            Liste des formateurs
        </a>
    </div>
{% endblock %}

{% block body %}
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Modifier les informations du formateur</h3>
                </div>
                <div class="card-body">
                    {{ form_start(form) }}
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h4 class="mb-3">Informations personnelles</h4>
                            
                            <div class="mb-3">
                                {{ form_label(form.firstName) }}
                                {{ form_widget(form.firstName) }}
                                {{ form_errors(form.firstName) }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.lastName) }}
                                {{ form_widget(form.lastName) }}
                                {{ form_errors(form.lastName) }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.email) }}
                                {{ form_widget(form.email) }}
                                {{ form_errors(form.email) }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.phone) }}
                                {{ form_widget(form.phone) }}
                                {{ form_errors(form.phone) }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.birthDate) }}
                                {{ form_widget(form.birthDate) }}
                                {{ form_errors(form.birthDate) }}
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h4 class="mb-3">Informations professionnelles</h4>
                            
                            <div class="mb-3">
                                {{ form_label(form.specialty) }}
                                {{ form_widget(form.specialty) }}
                                {{ form_errors(form.specialty) }}
                                {% if form.specialty.vars.help %}
                                    <div class="form-text">{{ form.specialty.vars.help }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.title) }}
                                {{ form_widget(form.title) }}
                                {{ form_errors(form.title) }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.qualifications) }}
                                {{ form_widget(form.qualifications) }}
                                {{ form_errors(form.qualifications) }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form_label(form.yearsOfExperience) }}
                                {{ form_widget(form.yearsOfExperience) }}
                                {{ form_errors(form.yearsOfExperience) }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <h4 class="mb-3">Adresse</h4>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        {{ form_label(form.address) }}
                                        {{ form_widget(form.address) }}
                                        {{ form_errors(form.address) }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        {{ form_label(form.postalCode) }}
                                        {{ form_widget(form.postalCode) }}
                                        {{ form_errors(form.postalCode) }}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form_label(form.city) }}
                                        {{ form_widget(form.city) }}
                                        {{ form_errors(form.city) }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form_label(form.country) }}
                                        {{ form_widget(form.country) }}
                                        {{ form_errors(form.country) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h4 class="mb-3">Biographie</h4>
                            
                            <div class="mb-3">
                                {{ form_label(form.biography) }}
                                {{ form_widget(form.biography) }}
                                {{ form_errors(form.biography) }}
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h4 class="mb-3">Paramètres du compte</h4>
                            
                            <div class="mb-3">
                                {{ form_label(form.plainPassword) }}
                                {{ form_widget(form.plainPassword) }}
                                {{ form_errors(form.plainPassword) }}
                                {% if form.plainPassword.vars.help %}
                                    <div class="form-text">{{ form.plainPassword.vars.help }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    {{ form_widget(form.isActive) }}
                                    {{ form_label(form.isActive) }}
                                </div>
                                {{ form_errors(form.isActive) }}
                                {% if form.isActive.vars.help %}
                                    <div class="form-text">{{ form.isActive.vars.help }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    {{ form_widget(form.emailVerified) }}
                                    {{ form_label(form.emailVerified) }}
                                </div>
                                {{ form_errors(form.emailVerified) }}
                                {% if form.emailVerified.vars.help %}
                                    <div class="form-text">{{ form.emailVerified.vars.help }}</div>
                                {% endif %}
                            </div>
                            
                            <!-- Current Status Info -->
                            <div class="alert alert-info">
                                <div class="d-flex">
                                    <div>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon alert-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/></svg>
                                    </div>
                                    <div>
                                        <h4 class="alert-title">Informations actuelles</h4>
                                        <div class="text-muted">
                                            <strong>Statut:</strong> 
                                            {% if teacher.isActive %}
                                                <span class="badge bg-success">Actif</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Inactif</span>
                                            {% endif %}
                                            <br>
                                            <strong>Email:</strong> 
                                            {% if teacher.emailVerified %}
                                                <span class="text-success">✓ Vérifié</span>
                                            {% else %}
                                                <span class="text-warning">⚠ Non vérifié</span>
                                            {% endif %}
                                            <br>
                                            <strong>Dernière connexion:</strong> 
                                            {% if teacher.lastLoginAt %}
                                                {{ teacher.lastLoginAt|date('d/m/Y H:i') }}
                                            {% else %}
                                                <span class="text-muted">Jamais connecté</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card-footer text-end">
                    <div class="d-flex">
                        <a href="{{ path('admin_teacher_show', {id: teacher.id}) }}" class="btn btn-link">Annuler</a>
                        <button type="submit" class="btn btn-primary ms-auto">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"/>
                                <path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
                                <path d="M14 4l0 4l-6 0l0 -4"/>
                            </svg>
                            Enregistrer les modifications
                        </button>
                    </div>
                </div>
                
                {{ form_end(form) }}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Confirm password change
            const passwordField = document.querySelector('#teacher_plainPassword');
            if (passwordField) {
                passwordField.addEventListener('input', function() {
                    if (this.value.trim() !== '') {
                        if (!confirm('Vous êtes sur le point de changer le mot de passe du formateur. Continuer ?')) {
                            this.value = '';
                        }
                    }
                });
            }
        });
    </script>
{% endblock %}
