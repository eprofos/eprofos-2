{% extends 'student/base.html.twig' %}

{% block body %}
    <div class="page-header d-print-none">
        <div class="container-xl">
            <div class="row g-2 align-items-center">
                <div class="col">
                    <div class="page-pretitle">
                        <a href="{{ path('student_alternance_meetings') }}">Réunions de Coordination</a>
                    </div>
                    <h2 class="page-title">{{ page_title }}</h2>
                    <div class="page-subtitle">
                        <span class="badge {{ meeting.statusBadgeClass }} me-2">{{ meeting.statusLabel }}</span>
                        <span class="badge bg-blue me-2">{{ meeting.typeLabel }}</span>
                        <span class="badge bg-secondary">{{ meeting.locationLabel }}</span>
                    </div>
                </div>
                <div class="col-auto ms-auto d-print-none">
                    <div class="btn-list">
                        <a href="{{ path('student_alternance_meetings') }}" class="btn btn-outline-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M9 14l-4 -4l4 -4"/>
                                <path d="M5 10h11a4 4 0 1 1 0 8h-1"/>
                            </svg>
                            Retour aux réunions
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-xl">
        <div class="row row-deck row-cards">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Meeting Info -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Informations de la réunion</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Date et heure</label>
                                    <div class="font-weight-medium">{{ meeting.date|date('d/m/Y à H:i') }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Durée</label>
                                    <div class="font-weight-medium">
                                        {% if meeting.duration %}
                                            {{ meeting.durationFormatted }}
                                        {% else %}
                                            Non renseignée
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Type de réunion</label>
                                    <div class="font-weight-medium">{{ meeting.typeLabel }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Lieu</label>
                                    <div class="font-weight-medium">{{ meeting.locationLabel }}</div>
                                </div>
                            </div>
                        </div>

                        {% if meeting.notes %}
                            <div class="mb-3">
                                <label class="form-label">Notes</label>
                                <div class="font-weight-medium">{{ meeting.notes|nl2br }}</div>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Agenda -->
                {% if meeting.agenda|length > 0 %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Ordre du jour</h3>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                {% for item in meeting.agenda %}
                                    <li class="d-flex mb-2">
                                        <div class="me-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon text-primary" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M9 11l3 3l8 -8"/>
                                                <path d="M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9"/>
                                            </svg>
                                        </div>
                                        <div>{{ item }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endif %}

                <!-- Discussion Points -->
                {% if meeting.discussionPoints|length > 0 %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Points de discussion</h3>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                {% for point in meeting.discussionPoints %}
                                    <li class="d-flex mb-3">
                                        <div class="me-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon text-warning" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M8 9h8"/>
                                                <path d="M8 13h6"/>
                                                <path d="M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z"/>
                                            </svg>
                                        </div>
                                        <div>{{ point }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endif %}

                <!-- Decisions -->
                {% if meeting.decisions|length > 0 %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Décisions prises</h3>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                {% for decision in meeting.decisions %}
                                    <li class="d-flex mb-3">
                                        <div class="me-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon text-success" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M5 12l5 5l10 -10"/>
                                            </svg>
                                        </div>
                                        <div>{{ decision }}</div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endif %}

                <!-- Action Plan -->
                {% if meeting.actionPlan|length > 0 %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Plan d'actions</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Action</th>
                                            <th>Responsable</th>
                                            <th>Échéance</th>
                                            <th>Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for action in meeting.actionPlan %}
                                            <tr>
                                                <td>{{ action.description|default(action) }}</td>
                                                <td>{{ action.responsible|default('-') }}</td>
                                                <td>
                                                    {% if action.deadline %}
                                                        {{ action.deadline|date('d/m/Y') }}
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if action.status is defined %}
                                                        {% if action.status == 'completed' %}
                                                            <span class="badge bg-success">Terminé</span>
                                                        {% elseif action.status == 'in_progress' %}
                                                            <span class="badge bg-warning">En cours</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">Planifié</span>
                                                        {% endif %}
                                                    {% else %}
                                                        <span class="badge bg-secondary">Planifié</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Meeting Report -->
                {% if meeting.meetingReport %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Compte-rendu</h3>
                        </div>
                        <div class="card-body">
                            <div class="markdown">
                                {{ meeting.meetingReport|nl2br }}
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Participants -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Participants</h3>
                    </div>
                    <div class="card-body">
                        {% if meeting.pedagogicalSupervisor %}
                            <div class="d-flex align-items-center mb-3">
                                <span class="avatar avatar-sm bg-primary text-white me-3">
                                    {{ meeting.pedagogicalSupervisor.fullName|slice(0,2)|upper }}
                                </span>
                                <div>
                                    <div class="font-weight-medium">{{ meeting.pedagogicalSupervisor.fullName }}</div>
                                    <div class="text-secondary small">Référent pédagogique</div>
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if meeting.mentor %}
                            <div class="d-flex align-items-center mb-3">
                                <span class="avatar avatar-sm bg-success text-white me-3">
                                    {{ meeting.mentor.fullName|slice(0,2)|upper }}
                                </span>
                                <div>
                                    <div class="font-weight-medium">{{ meeting.mentor.fullName }}</div>
                                    <div class="text-secondary small">Tuteur entreprise</div>
                                </div>
                            </div>
                        {% endif %}

                        <div class="d-flex align-items-center mb-3">
                            <span class="avatar avatar-sm bg-info text-white me-3">
                                {{ app.user.fullName|slice(0,2)|upper }}
                            </span>
                            <div>
                                <div class="font-weight-medium">{{ app.user.fullName }}</div>
                                <div class="text-secondary small">Alternant (vous)</div>
                            </div>
                        </div>

                        {% if meeting.attendees|length > 0 %}
                            <hr>
                            <div class="text-secondary small mb-2">Autres participants</div>
                            {% for attendee in meeting.attendees %}
                                <div class="d-flex align-items-center mb-2">
                                    <span class="avatar avatar-sm bg-secondary text-white me-3">
                                        {{ attendee.name|default(attendee)|slice(0,2)|upper }}
                                    </span>
                                    <div>
                                        <div class="font-weight-medium">{{ attendee.name|default(attendee) }}</div>
                                        {% if attendee.role is defined %}
                                            <div class="text-secondary small">{{ attendee.role }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <!-- Next Meeting -->
                {% if meeting.nextMeetingDate %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Prochaine réunion</h3>
                        </div>
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <span class="avatar avatar-sm bg-yellow text-white me-3">
                                    {{ meeting.nextMeetingDate|date('d') }}
                                </span>
                                <div>
                                    <div class="font-weight-medium">{{ meeting.nextMeetingDate|date('d/m/Y') }}</div>
                                    <div class="text-secondary">{{ meeting.nextMeetingDate|date('H:i') }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Satisfaction -->
                {% if meeting.satisfactionRating %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Satisfaction</h3>
                        </div>
                        <div class="card-body text-center">
                            <div class="h2">{{ meeting.satisfactionStars }}</div>
                            <div class="text-secondary">{{ meeting.satisfactionRating }}/5</div>
                        </div>
                    </div>
                {% endif %}

                <!-- Meeting Summary -->
                {% if meeting.isCompleted %}
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3 class="card-title">Résumé</h3>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="h4">{{ meeting.agenda|length }}</div>
                                    <div class="text-secondary small">Points à l'ordre du jour</div>
                                </div>
                                <div class="col-6">
                                    <div class="h4">{{ meeting.decisions|length }}</div>
                                    <div class="text-secondary small">Décisions prises</div>
                                </div>
                            </div>
                            <hr>
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="h4">{{ meeting.actionPlan|length }}</div>
                                    <div class="text-secondary small">Actions planifiées</div>
                                </div>
                                <div class="col-6">
                                    {% if meeting.duration %}
                                        <div class="h4">{{ meeting.duration }}min</div>
                                        <div class="text-secondary small">Durée</div>
                                    {% else %}
                                        <div class="h4">-</div>
                                        <div class="text-secondary small">Durée</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Timeline Info -->
                {% if meeting.isUpcoming %}
                    <div class="card mt-4 border-primary">
                        <div class="card-header">
                            <h3 class="card-title text-primary">Réunion à venir</h3>
                        </div>
                        <div class="card-body">
                            {% set timeUntil = meeting.timeUntilMeeting %}
                            {% if timeUntil %}
                                <div class="text-center">
                                    <div class="h2 text-primary">{{ timeUntil.days }}</div>
                                    <div class="text-secondary">jour{{ timeUntil.days > 1 ? 's' : '' }} restant{{ timeUntil.days > 1 ? 's' : '' }}</div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
