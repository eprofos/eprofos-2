{#
    Formations List Partial Template for Ajax Responses
    
    This template is used for Ajax filtering responses and renders:
    - Formation cards grid
    - Pagination controls  
    - No results message when empty
    
    Variables provided by controller:
    - formations: Collection of Formation entities
    - current_page: Current page number
    - total_pages: Total number of pages
    - total_formations: Total formations count
#}

{% if formations is not empty %}
    {# Formations Grid #}
    {% for formation in formations %}
        <div class="col-lg-4 col-md-6 mb-4">
            {% include 'public/components/formation_card.html.twig' with {
                'formation': formation,
                'show_category': true,
                'show_excerpt': true
            } %}
        </div>
    {% endfor %}
    
    {# Pagination Section #}
    {% if total_pages > 1 %}
        <div class="col-12">
            <nav aria-label="Navigation des formations" class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="pagination-info">
                        <span class="text-muted">
                            Page {{ current_page }} sur {{ total_pages }} 
                            ({{ total_formations }} formation{{ total_formations > 1 ? 's' : '' }} au total)
                        </span>
                    </div>
                </div>
                
                <ul class="pagination justify-content-center">
                    {# Previous page #}
                    {% if current_page > 1 %}
                        <li class="page-item">
                            <button class="page-link" 
                                    data-formation-filter-target="pageBtn"
                                    data-page="{{ current_page - 1 }}"
                                    style="border-radius: 10px 0 0 10px;">
                                <i class="fas fa-chevron-left me-1"></i>Précédent
                            </button>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link" style="border-radius: 10px 0 0 10px;">
                                <i class="fas fa-chevron-left me-1"></i>Précédent
                            </span>
                        </li>
                    {% endif %}

                    {# Page numbers #}
                    {% set start_page = max(1, current_page - 2) %}
                    {% set end_page = min(total_pages, current_page + 2) %}
                    
                    {# First page if not in range #}
                    {% if start_page > 1 %}
                        <li class="page-item">
                            <button class="page-link" 
                                    data-formation-filter-target="pageBtn"
                                    data-page="1">1</button>
                        </li>
                        {% if start_page > 2 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        {% endif %}
                    {% endif %}

                    {# Page range #}
                    {% for page in start_page..end_page %}
                        <li class="page-item {{ page == current_page ? 'active' : '' }}">
                            {% if page == current_page %}
                                <span class="page-link bg-primary border-primary">{{ page }}</span>
                            {% else %}
                                <button class="page-link" 
                                        data-formation-filter-target="pageBtn"
                                        data-page="{{ page }}">{{ page }}</button>
                            {% endif %}
                        </li>
                    {% endfor %}

                    {# Last page if not in range #}
                    {% if end_page < total_pages %}
                        {% if end_page < total_pages - 1 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        {% endif %}
                        <li class="page-item">
                            <button class="page-link" 
                                    data-formation-filter-target="pageBtn"
                                    data-page="{{ total_pages }}">{{ total_pages }}</button>
                        </li>
                    {% endif %}

                    {# Next page #}
                    {% if current_page < total_pages %}
                        <li class="page-item">
                            <button class="page-link" 
                                    data-formation-filter-target="pageBtn"
                                    data-page="{{ current_page + 1 }}"
                                    style="border-radius: 0 10px 10px 0;">
                                Suivant<i class="fas fa-chevron-right ms-1"></i>
                            </button>
                        </li>
                    {% else %}
                        <li class="page-item disabled">
                            <span class="page-link" style="border-radius: 0 10px 10px 0;">
                                Suivant<i class="fas fa-chevron-right ms-1"></i>
                            </span>
                        </li>
                    {% endif %}
                </ul>

                {# Quick page jump for many pages #}
                {% if total_pages > 10 %}
                    <div class="text-center mt-3">
                        <div class="d-inline-flex align-items-center gap-2">
                            <span class="text-muted">Aller à la page :</span>
                            <input type="number" 
                                   class="form-control form-control-sm" 
                                   style="width: 80px; border-radius: 10px;" 
                                   min="1" 
                                   max="{{ total_pages }}" 
                                   value="{{ current_page }}"
                                   data-formation-filter-target="pageInput">
                            <button class="btn btn-sm btn-outline-primary" 
                                    style="border-radius: 10px;"
                                    data-formation-filter-target="pageJumpBtn">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                {% endif %}
            </nav>
        </div>
    {% endif %}
    
{% else %}
    {# No Results Message #}
    <div class="col-12">
        <div class="text-center py-5">
            <div class="mb-4">
                <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 120px; height: 120px;">
                    <i class="fas fa-search fa-3x text-muted"></i>
                </div>
            </div>
            <h4 class="fw-bold mb-3">Aucune formation trouvée</h4>
            <p class="text-muted mb-4">
                Aucune formation ne correspond à vos critères de recherche. 
                Essayez de modifier vos filtres ou explorez toutes nos formations.
            </p>
            <div class="d-flex flex-wrap gap-3 justify-content-center">
                <button class="btn btn-primary" 
                        style="border-radius: 25px;"
                        data-formation-filter-target="clearBtn">
                    <i class="fas fa-eraser me-2"></i>Effacer les filtres
                </button>
                <a href="{{ path('app_formations_index') }}" 
                   class="btn btn-outline-primary" 
                   style="border-radius: 25px;">
                    <i class="fas fa-eye me-2"></i>Voir toutes les formations
                </a>
                <a href="{{ path('app_contact_quote') }}" 
                   class="btn btn-warning" 
                   style="border-radius: 25px;">
                    <i class="fas fa-plus me-2"></i>Formation sur mesure
                </a>
            </div>
        </div>
    </div>
{% endif %}
